<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Microcredenciais Paraná</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootswatch -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/litera/bootstrap.min.css">

  <link rel="stylesheet" href="../css/apresentacao.css">
</head>

<body>

<!-- NAV -->
<nav class="top-nav">
  <div class="nav-container">
    <div class="nav-logo">
      <img src="../imagem/logo_microcredenciais.png" height="80">
    </div>
  </div>
</nav>

<!-- CONTEÚDO -->
<main class="container">

  <section class="hero-content">
    <h1 class="title">
      Apresentação do(a) Professor(a)
      <span class="subtitle">Finalização</span>
    </h1>

    <div class="message-box">
      <p>
       <b>Aqui é o momento de apresentação do(a) professor(a). A mensagem precisa ser acolhedora iniciando um processo de aproximação. A apresentação ocorrerá de duas maneiras: com TEXTO e VÍDEO.</b>
       <p>Fale brevemente um pouco sobre a sua jornada profissional, enfatizando as informações principais. Pode ser escrito em primeira pessoa. O texto deve ter no máximo dois parágrafos. Também será disponibilizado o link do currículo do professor na plataforma Lattes.
        de encerramento, onde o PDF único será gerado para conferência e envio.</p>
      </p>
    </div>
  </section>

  <!-- TEXTO -->
  <label class="form-label fw-semibold">
    Apresentação do(a) professor(a)
  </label>

  <textarea
  id="apnprofessor"
  class="texto form-control form-control-lg mb-4"
  rows="5"
  placeholder="Escreva aqui sua apresentação">
</textarea>


  <!-- YOUTUBE -->
  <label class="form-label fw-semibold" for="youtubeProfessor">
    Link do vídeo do professor
  </label>

  <input
    type="url"
    class="form-control mb-4"
    id="youtubeProfessor"
    placeholder="https://www.youtube.com/watch?v=..."
    autocomplete="off"
  />

  <!-- LATTES -->
  <label class="form-label fw-semibold" for="lattesUrl">
    Currículo Lattes
  </label>

  <input
    type="url"
    class="form-control mb-4"
    id="lattesUrl"
    placeholder="https://lattes.cnpq.br/"
    autocomplete="off"
  />

  <!-- MENU -->
  <div class="menu-grid">

    <a href="./apresentacao_3.html" class="menu-item blue">
      <div class="icon-container">
        <div class="icon-inner">
          <img src="../imagem/esquerda.png" alt="Anterior" style="width: 50%;">
        </div>
      </div>
      <div class="label">Anterior</div>
    </a>

    <a href="../index.html" class="menu-item blue">
      <div class="icon-container">
        <div class="icon-inner">
          <img src="../imagem/home.png" alt="Home" style="width: 50%;">
        </div>
      </div>
      <div class="label">Home</div>
    </a>

    <!-- AGORA APENAS NAVEGA -->
    <a href="../desafio/desafio_0.html" class="menu-item blue">
      <div class="icon-container">
        <div class="icon-inner">
          <img src="../imagem/direita.png" alt="Próximo" style="width: 50%;">
        </div>
      </div>
      <div class="label">Próximo</div>
    </a>

  </div>

  <!-- LEMBRETE -->
  <div class="message-box">
    <p>
      <b>LEMBRETE:</b>
      Você poderá gerar e revisar o PDF final na próxima etapa,
      antes do envio oficial pelo AVA Moodle.
    </p>
  </div>

</main>

<footer class="bottom-nav">
  <div class="footer-container">
    <p>&copy; 2026 UVPR - Universidade Virtual do Paraná</p>
  </div>
</footer>

<!-- ======================================================
     JAVASCRIPT — AUTOSAVE + RESTORE (SEM PDF)
====================================================== -->
<script>
/* ================= CONFIG ================= */
const DB_NAME = "microcredenciais_db";
const STORE_META = "meta";
const STORE_TEXTS = "texts";

/* ================= DB ================= */
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = () => {
      const db = req.result;
      if (!db.objectStoreNames.contains(STORE_META))
        db.createObjectStore(STORE_META, { keyPath: "key" });
      if (!db.objectStoreNames.contains(STORE_TEXTS))
        db.createObjectStore(STORE_TEXTS, { keyPath: "field" });
    };
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

/* ================= META ================= */
async function putMeta(key, value) {
  const db = await openDB();
  db.transaction(STORE_META, "readwrite")
    .objectStore(STORE_META)
    .put({ key, value: value ?? "" });
}

async function getMeta(key) {
  const db = await openDB();
  return new Promise(resolve => {
    const req = db.transaction(STORE_META)
      .objectStore(STORE_META)
      .get(key);
    req.onsuccess = () => resolve(req.result?.value || "");
  });
}

/* ================= TEXTOS ================= */
async function putText(field, value) {
  const db = await openDB();
  db.transaction(STORE_TEXTS, "readwrite")
    .objectStore(STORE_TEXTS)
    .put({ field: Number(field), value: value || "" });
}

async function getAllTexts() {
  const db = await openDB();
  return new Promise(resolve => {
    const req = db.transaction(STORE_TEXTS)
      .objectStore(STORE_TEXTS)
      .getAll();
    req.onsuccess = () => resolve(req.result || []);
  });
}

/* ================= AUTOSAVE + RESTORE ================= */
document.addEventListener("DOMContentLoaded", async () => {

  const fields = document.querySelectorAll("input, textarea, select");

  /* RESTAURA */
  const texts = await getAllTexts();
  const map = {};
  texts.forEach(t => map[t.field] = t.value);

  for (const el of fields) {
    if (el.dataset.field) {
      el.value = map[el.dataset.field] || "";
    } else if (el.id) {
      el.value = await getMeta(el.id);
    }
  }

  /* SALVA */
  fields.forEach(el => {
    const save = () => {
      if (el.dataset.field) {
        putText(el.dataset.field, el.value);
      } else if (el.id) {
        putMeta(el.id, el.value);
      }
    };
    el.addEventListener("input", save);
    el.addEventListener("change", save);
  });
});
</script>

</body>
</html>
