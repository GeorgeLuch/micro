<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microcredenciais Paraná</title>

  <!-- Bootswatch (já inclui Bootstrap) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/litera/bootstrap.min.css">

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- pdf-lib -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js" defer></script>

  <!-- Seu JS -->
  <script src="./javascript.js" defer></script>

  <link rel="stylesheet" href="../style.css">
</head>

<body class="bg-light">

  <nav class="top-nav bg-white border-bottom shadow-sm">
    <div class="nav-container d-flex align-items-center py-2">
      <div class="nav-logo">
        <img src="../imagem/logo_microcredenciais.png" alt="Descrição da imagem" height="80">
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <section class="hero-content">
      <h1 class="title mb-3">
        Encerramento / Transformação
        <span class="subtitle text-primary fw-semibold ms-2">Parabéns</span>
      </h1>

      <div class="message-box card shadow-sm p-4">
        <p class="mb-3">
          Nesta etapa, o professor deve fazer um encerramento geral do curso, além de parabenizar o aluno pela
          finalização da jornada.
        </p>
        <p class="mb-4">
          Também é o momento de o professor sugerir as próximas etapas, indicando
          assuntos a serem estudados ou experimentos/exercícios que podem ser feitos para fixação dos
          conteúdos.
        </p>

        <textarea id="textoEtapa" class="stage-mini form-control form-control-lg" rows="5"
          placeholder="Insira aqui o texto referente à etapa."></textarea>

        <button id="btnSalvar" class="btn btn-success mt-3">
          Enviar
        </button>

        <!--<div class="form-text mt-2 text-muted">
          Clique em “Salvar” para gravar o conteúdo no Google Drive.
        </div> -->
      </div>
    </section>
  </main>

  <footer class="bottom-nav bg-white border-top mt-5">
    <div class="footer-container text-center py-3">
      <p class="copyright mb-0 text-muted">
        &copy; 2026 UVPR - Universidade Virtual do Paraná
      </p>
    </div>
  </footer>

<script>
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyeRwyloUqqg4Z14sp1fJweevnWIDvEHD5ZDE8ei4X-crWBC94CZMRP-xD3SNApHTET/exec";

  const textarea = document.getElementById("textoEtapa");
  const btnSalvar = document.getElementById("btnSalvar");

  btnSalvar.addEventListener("click", async () => {
    const texto = textarea.value.trim();

    if (!texto) {
      Swal.fire({
        icon: "warning",
        title: "Campo vazio",
        text: "Digite o texto antes de salvar."
      });
      return;
    }

    btnSalvar.disabled = true;
    btnSalvar.innerText = "Salvando...";

    try {
      // Envio "simples" (sem JSON e sem header) para evitar preflight
      const form = new URLSearchParams();
      form.append("etapa", "Encerramento / Transformação");
      form.append("conteudo", texto);

      await fetch(WEBAPP_URL, {
        method: "POST",
        mode: "no-cors", // evita bloqueio CORS (resposta fica "opaque")
        body: form
      });

      // Como mode:no-cors não permite ler a resposta, confirmamos o envio
      Swal.fire({
        icon: "success",
        title: "Enviado!",
        //text: "O texto foi enviado para o Google Drive. Verifique seu Drive (arquivos recentes)."
      });

    } catch (e) {
      Swal.fire({
        icon: "error",
        title: "Erro ao salvar",
        text: "Falha ao enviar para o Drive. Confira a implantação do Web App e sua conexão."
      });
      console.error(e);
    } finally {
      btnSalvar.disabled = false;
      btnSalvar.innerText = "Salvar";
    }
  });
</script>


</body>

</html>
