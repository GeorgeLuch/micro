<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microcredenciais Paraná</title>

  <!-- Bootswatch (já inclui Bootstrap) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/litera/bootstrap.min.css">

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- pdf-lib -->
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js" defer></script>

  <!-- Seu JS -->
  <script src="./javascript.js" defer></script>

  <link rel="stylesheet" href="../style.css">
</head>

<body class="bg-light">

  <nav class="top-nav bg-white border-bottom shadow-sm">
    <div class="nav-container d-flex align-items-center py-2">
      <div class="nav-logo">
        <img src="../imagem/logo_microcredenciais.png" alt="Descrição da imagem" height="80">
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <section class="hero-content">
      <h1 class="title mb-3">
        Encerramento / Transformação
        <span class="subtitle text-primary fw-semibold ms-2">Parabéns</span>
      </h1>

      <div class="message-box card shadow-sm p-4">
        <p class="mb-3">
          Nesta etapa, o professor deve fazer um encerramento geral do curso, além de parabenizar o aluno pela
          finalização da jornada.
        </p>
        <p class="mb-4">
          Também é o momento de o professor sugerir as próximas etapas, indicando
          assuntos a serem estudados ou experimentos/exercícios que podem ser feitos para fixação dos
          conteúdos.
        </p>

        <textarea id="textoEtapa" class="stage-mini form-control form-control-lg" rows="5"
          placeholder="Insira aqui o texto referente à etapa."></textarea>

        <button id="btnSalvar" class="btn btn-success mt-3">
          Enviar
        </button>

        <!--<div class="form-text mt-2 text-muted">
          Clique em “Salvar” para gravar o conteúdo no Google Drive.
        </div> -->
      </div>
    </section>
  </main>

 <footer class="bottom-nav">
        <div class="footer-container">
            <!--<ul class="footer-links">
                            <li><a href="#">Sobre o Programa</a></li>
                            <li><a href="#">Termos de Uso</a></li>
                            <li><a href="#">Privacidade</a></li>
                            <li><a href="#">Ajuda</a></li>
                        </ul>-->
            <p class="copyright">© 2026 UVPR - Universidade Virtual do Paraná</p>
        </div>
    </footer>

<script>
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzHt-FtJxKMpc3S_wYEk3pkbCQAXAyAIBN4SFrvPP0dOUNLn0kSwa7EZ6FIoANSemGj/exec";

  const textarea = document.getElementById("textoEtapa");
  const btnSalvar = document.getElementById("btnSalvar");

  btnSalvar.addEventListener("click", async () => {
    const texto = textarea.value.trim();

    if (!texto) {
      Swal.fire({ icon: "warning", title: "Campo vazio", text: "Digite o texto antes de salvar." });
      return;
    }

    btnSalvar.disabled = true;
    btnSalvar.innerText = "Salvando...";

    try {
      // Envia como FORM (o Apps Script lê via e.parameter)
      const form = new URLSearchParams();
      form.append("etapa", "Encerramento / Transformação");
      form.append("conteudo", texto);

      const resp = await fetch(WEBAPP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body: form.toString()
      });

      const data = await resp.json();

      if (!data.ok) {
        throw new Error(data.error || "Falha ao salvar.");
      }

      // 1) Primeiro alerta (mantém como você pediu)
      const r1 = await Swal.fire({
        icon: "success",
        title: "Enviado!",
        text: "Conteúdo Salvo.",
        confirmButtonText: "OK"
      });

      // 2) Ao clicar OK, mostrar a tela de Encerramento (no mesmo estilo)
      if (r1.isConfirmed) {
        await Swal.fire({
          title: `<div style="text-align:left">
                    <div style="font-size:32px; font-weight:800; color:#0d6efd; margin-bottom:6px;">
                      Encerramento
                    </div>
                    <div style="font-size:22px; font-weight:800; color:#16a34a;">
                      Parabéns
                    </div>
                  </div>`,
          html: `<div style="text-align:left; margin-top:10px">
                  <div style="border-left:6px solid #16a34a; padding-left:14px; color:#374151; line-height:1.45">
                    Você concluiu o desenvolvimento do seu curso! Clique no botão abaixo para abrir sua disciplina em uma nova aba.
                    Faça uma conferência geral. Caso queria fazer algum ajuste, basta retornar a qualquer uma das etapas anteriores e atualizar os conteúdos ou os links.
                    Se estiver tudo OK, basta clicar em finalizar, e o material será encaminhado para a nossa equipe de desenvolvimento.
                  </div>

                  <div style="margin-top:14px; font-size:12px; color:#6b7280">
                    Salvo em: <b>${data.folderName || "Drive"}</b><br>
                    Arquivo: <b>${data.fileName || "—"}</b>
                  </div>
                </div>`,
          icon: undefined,
          showConfirmButton: true,
          confirmButtonText: "Abrir disciplina",
          showCancelButton: true,
          cancelButtonText: "Fechar",
        }).then((r2) => {
          if (r2.isConfirmed) {
            // Coloque aqui o link da disciplina (ou o link que você quiser abrir)
            // Exemplo:
            window.open("https://www.google.com", "_blank");
          }
        });
      }

    } catch (e) {
      console.error(e);
      Swal.fire({
        icon: "error",
        title: "Erro ao salvar",
        text: e.message || "Falha ao enviar para o Drive. Confira a implantação do Web App."
      });
    } finally {
      btnSalvar.disabled = false;
      btnSalvar.innerText = "Enviar";
    }
  });
</script>

</script>


</body>

</html>
